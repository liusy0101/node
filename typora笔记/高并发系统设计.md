[toc]

# 高并发系统设计

## 一、基础

### 1、高并发系统：通用设计方法

在应对高并发大流量时会采用三种方法：

- Scale-out（横向扩展）： 分而治之是一种常见的高并发系统设计方法，采用分布式部署方式将流量分流，让多个服务器共同承担并发和流量
- 缓存： 使用缓存来提高系统性能
- 异步： 在某些场景下，未处理完成之前，可让请求先返回，在数据准备好之后在通知请求方



#### （1） Scale-out

Scale-up： 通过性能更好的硬件来提升系统并发处理能力

Scale-out： 通过将多个一般性能的机器组成一个分布式集群来提升系统并发处理能力


#### （2）缓存

数据存储在磁盘中，读取时间相比于内存要慢几个数量级

例如：使用redis


#### （3）异步

调用方不需要等待方法逻辑执行完成就可以返回执行其他逻辑，在被调用方法执行完毕后再通过回调、事件通知等方式将结果反馈给调用方。

例如：使用消息队列




#### （4）总结

高并发系统的演进应该是循序渐进，以解决系统中存在的问题为目的和驱动力的。



### 2、分层架构

软件架构分层是一种常见的设计方式，是将整体系统拆分成N个层次，每个层次有独立的职责，多个层次协同提供完整的功能。



#### （1）分层好处

分层设计可简化系统设计，让不同的人专注做某一层次的事情。

分层之后可做到高复用：具有通用性的模块可独立出来复用

分层架构更容易做横向扩展



#### （2）如何做系统分层

![1639028057494](typora-user-images/1639028057494.png)

- 终端显示层： 各端模板渲染并执行显示
- 开放接口层： 将Service层方法封装成开放接口，同时进行网关安全控制和流量控制等。
- Web层： 主要是对访问控制进行转发，各类基本参数校验，或者不复用的业务简单处理等。
- Service层： 业务逻辑层
- Manager层： 通用业务处理层。有两个作用：一是可将原先Service层的一些通用能力下沉到这一层，比如与缓存和存储交互策略、中间件介入；二是也可在这一层封装对第三方接口的调用，比如调用支付服务，调用审核服务等。
- DAO层： 数据访问层，与底层mysql、hbase等进行数据交互
- 外部接口或第三方凭条： 包括其他部门RPC开放接口，基础平台，其他公司的HTTP接口

Manager层与Service层的关系是：Manager层提供原子的服务接口，Service层负责依据业务逻辑来编排原子接口。


分层架构需要考虑的另一个因素：是层次之间一定是相邻层互相依赖，数据的流转也只能在相邻的两层之间流转。

